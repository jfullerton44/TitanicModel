---
title: "Titanic Project"
author: "Jacob Fullerton, Levi Moneyhun, Yinhao Ge, and Amrita Singh"
date: "11/7/2018"
output: html_document
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(tidyverse)
library(randomForest)
library(caret)
library(gmodels)

titanic <- read.csv("titanic_train_set.csv", header = TRUE, sep = ",")
test <- read.csv("titanic_test_set.csv", header = TRUE, sep = ",")
F=c(2,3,4,9)
for(i in F) titanic[,i]=as.factor(titanic[,i])
for(i in F) test[,i]=as.factor(test[,i])
```

```{r Partition Data}
train_index <- createDataPartition(titanic$Survived,
                                   p = .75,
                                   list = FALSE,
                                   times = 1)

training_set <- titanic[train_index,]
validation_set <- titanic[-train_index,]
```

```{r Make Model}

bestModel <- randomForest(training_set[,-2], training_set$Survived, 
                       sampsize = round(0.6*(length(training_set$Survived))),ntree = 500, 
                       mtry = sqrt(7), importance = TRUE)
print(bestModel)
bestAccuracy <- mean(bestModel == validation_set$Survived)


F=c(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16)
N=c(5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,90,100,110,120,130,140,150,160,170,180,190,200)
Max = c(1,2,3,4,5,6)


for (j in F){
 for(i in N){
  # for(m in F){
      titanic_model_new <- randomForest(training_set[,-2], training_set$Survived ,
                    nodesize = j,
                    sampsize = i,
                   # maxnodes = m,
                    ntree = 500, 
                    mtry = sqrt(7),
                    importance = TRUE)
      
      titanic_pred_new <- predict(titanic_model_new, validation_set)
      #print(j)
    
     # CrossTable(validation_set$Survived, titanic_pred_new,
      #           prop.chisq = FALSE, prop.c = FALSE, prop.r = FALSE,
        #         dnn = c('actual default', 'predicted default'))
      
      #print(postResample(titanic_pred_new, validation_set$Survived))
      accuracy <- mean(titanic_pred_new == validation_set$Survived)
      if( accuracy > bestAccuracy) {
        bestModel <- titanic_model_new
        bestAccuracy <- accuracy
        print(accuracy)
        besti <- i
        bestj <- j
        print("J")
        print(j)
        print("I")
        print(i)
        print("M")
        #print(M)
      }

  }
}
#}
```


```{r}
rfcv(training_set[,-2], training_set$Survived )

```


```{r Get Importance}

importance <- varImp(bestModel)
importance_sort <- importance[order(importance[,1], decreasing = TRUE),]

importance_sort
## Sex and Pclass are most important, 

```


```{r Make Output}

print(test[,-2])
testOut <- predict(bestModel,test[,-2])



output <- transmute(test,
                  #  ID = PassengerID, 
                    p = testOut
)

write.csv(output,'submission.csv', quote= FALSE)              
```